PRAGMA foreign_keys = ON;

CREATE TABLE IF NOT EXISTS category (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT UNIQUE NOT NULL,
  max_items INTEGER NOT NULL DEFAULT 1
);

CREATE TABLE IF NOT EXISTS garment (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,
  category_id INTEGER NOT NULL,
  sprite_path TEXT NOT NULL,
  score_theme TEXT DEFAULT NULL,
  price INTEGER DEFAULT 0,
  FOREIGN KEY(category_id) REFERENCES category(id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS mannequin (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,
  base_sprite_path TEXT NOT NULL
);

CREATE TABLE IF NOT EXISTS theme (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  code TEXT UNIQUE NOT NULL,
  label TEXT NOT NULL
);

CREATE TABLE IF NOT EXISTS run_result (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  mannequin_id INTEGER NOT NULL,
  theme_id INTEGER NOT NULL,
  score INTEGER NOT NULL,
  money_earned INTEGER NOT NULL,
  created_at TEXT DEFAULT (datetime('now')),
  FOREIGN KEY(mannequin_id) REFERENCES mannequin(id),
  FOREIGN KEY(theme_id) REFERENCES theme(id)
);
